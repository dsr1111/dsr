<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/login.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="icon" href="image/icon.png" type="image/x-icon" />
    <title>DSR WIKI</title>
    <script src="
    https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js
    "></script>
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
</head>
<body>
    <section class="login-form">
        <h1>DSR WIKI</h1>
        <form action="">
            <div class="int-area">
                <input type="text" name="id" id="id" autocomplete="off" required>
                <label for="id">닉네임</label>
            </div>
            <div class="int-area">
                <input type="password" name="pw" id="pw" autocomplete="off" required>
                <label for="pw">비밀번호</label>
            </div>
            <div class="btn-area">
                <button id="btn" type="submit">LOGIN</button>
            </div>
        </form>
        <div class="caption">
            <a id="signup-link">회원가입</a>
        </div>
    </section>

    <!-- Popup Modal -->
    <div class="overlay" id="signup-modal">
        <div class="modal">
            <button class="close-btn" id="close-btn">&times;</button>
            <h2>회원가입</h2>
            <div class="int-area">
                <input type="text" name="email" id="signup-email" autocomplete="off" required>
                <label for="signup-email">닉네임</label>
            </div>
            <div class="int-area">
                <input type="password" name="password" id="signup-password" autocomplete="off" required>
                <label for="signup-password">비밀번호</label>
            </div>
            <button type="button" id="signup-submit">회원가입</button>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyB687ow_NvAJxJdLaSfke6hOalFujAeJ50",
          authDomain: "dsr1-59d0e.firebaseapp.com",
          projectId: "dsr1-59d0e",
          storageBucket: "dsr1-59d0e.firebasestorage.app",
          messagingSenderId: "393673268086",
          appId: "1:393673268086:web:42409e7320c0ad4d99f857",
          measurementId: "G-V5VLCXSKM7"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const auth = getAuth();

        document.getElementById('signup-submit').addEventListener('click', (event) => {
            event.preventDefault();

            const emailDomain = "@123.123";
            const signupemail = document.getElementById('signup-email').value.trim();
            const signuppassword = document.getElementById('signup-password').value;

            // 이메일 도메인 중복 확인 및 추가
            const fullEmail = signupemail.includes('@') ? signupemail : signupemail + emailDomain;

            // Firebase 회원가입
            createUserWithEmailAndPassword(auth, fullEmail, signuppassword)
                .then((userCredential) => {
                    // 회원가입 성공
                    const user = userCredential.user;
                    alert("회원가입이 완료되었습니다.");
                    document.getElementById('signup-modal').style.display = 'none';
                })
                .catch((error) => {
                    // 회원가입 실패 처리
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    alert(`회원가입 실패: ${errorMessage}`);
                });
        });


        document.getElementById('btn').addEventListener('click', (event) => {
            event.preventDefault()
            const emailDomain = "@123.123";
            const email = document.getElementById('id').value.trim();
            const password = document.getElementById('pw').value

            const fullEmail = email.includes('@') ? email : email + emailDomain;

            signInWithEmailAndPassword(auth, fullEmail, password)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    window.location.href = 'main.html';
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    alert(`아이디, 비밀번호를 다시 확인해 주세요.`);
                });
        })


        let id = $('#id');
        let pw = $('#pw');
        let btn = $('#btn');

        $(btn).on('click', function() {
            if($(id).val() == "") {
                $(id).next('label').addClass('warning');
                setTimeout(function() {
                    $('label').removeClass('warning');
                },1500);
            }
            else if($(pw).val() == "") {
                $(pw).next('label').addClass('warning');
                setTimeout(function() {
                    $('label').removeClass('warning');
                },1500);
            }
        });

        document.getElementById('signup-link').addEventListener('click', function (event) {
            event.preventDefault();
            console.log("회원가입 버튼 클릭됨");
            document.getElementById('signup-modal').style.display = 'flex';
        });

        document.getElementById('close-btn').addEventListener('click', function () {
            document.getElementById('signup-modal').style.display = 'none';
        });
      </script>

</body>
</html>
